<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="app-title">RemedySense Interactive Project Showcase (Earthy Green Theme)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom Keyframes and Classes for Earthy Green Theme */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        
        .ingredient-card, .flow-step-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Hover Lift Effect */
        .card-lift:hover {
            transform: translateY(-5px);
            /* Updated shadow to dark green tone */
            box-shadow: 0 10px 20px rgba(56, 118, 29, 0.2); 
        }

        /* New Gradient Text (Green) */
        .gradient-text {
            /* Updated gradient to warm green shades */
            background-image: linear-gradient(to right, #38761D, #6AA84F);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        /* Flowchart Styles with new colors */
        .flow-step-card {
            /* Updated border to highlight green */
            @apply p-6 rounded-xl shadow-lg border-t-4 border-[#6AA84F] transition duration-300 hover:shadow-xl text-center h-full;
        }
        .flow-arrow-mobile, .flow-arrow-desktop {
            /* Updated arrow color to dark green */
            @apply flex justify-center py-4 text-[#38761D] font-bold;
        }

        /* Scroll-Reveal Animation Styles (PERMANENT FIX FOR VISIBILITY) */
        .fade-in-up {
            /* FIXED: Ensure visibility immediately by default */
            opacity: 1 !important;        
            transform: translateY(0) !important; 
            /* The 'is-visible' class and all scroll-reveal JS is now redundant and removed/ignored */
            transition: opacity 1s ease-out, transform 0.8s ease-out;
        }
        .fade-in-up.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Webcam Specific Styles */
        #video-feed {
            width: 100%;
            max-width: 600px;
            height: auto;
            min-height: 200px;
            background-color: #2C3A2F; /* Dark background for the feed area */
            border: 4px solid #6AA84F; /* Updated border to highlight green */
            border-radius: 0.75rem;
            object-fit: cover;
            transform: scaleX(-1); 
            display: none; 
            margin: 0 auto;
        }
        #captured-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            border: 3px solid #38761D; /* Updated border to primary green */
            border-radius: 0.75rem;
            object-fit: cover;
            margin: 0 auto;
            display: none;
        }

        /* Custom Styles for Filter Buttons (Ingredient Explorer) */
        .filter-label {
            display: inline-block;
            padding: 8px 12px;
            border: 1px solid #6AA84F; /* brand-primary-accent */
            border-radius: 20px;
            cursor: pointer;
            background-color: #f0f8ee; /* light green tint */
            color: #38761D; /* brand-primary-dark */
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            line-height: 1;
        }

        .filter-input[type="checkbox"] {
            display: none; /* Hide the default checkbox */
        }

        .filter-input[type="checkbox"]:checked + .filter-label {
            background-color: #6AA84F; /* brand-primary-accent */
            color: white;
            box-shadow: 0 2px 5px rgba(56, 118, 29, 0.4);
        }

        /* Custom Styles for Sample Image Selector */
        .sample-image-button img {
            transition: all 0.2s;
            border-color: transparent !important;
        }
        .sample-image-button.active img {
            border-color: #38761D !important;
            box-shadow: 0 0 0 3px #6AA84F;
        }

        /* Styles for the new Tabbed Interface */
        .tab-button {
            @apply text-lg mx-2 border-b-2 border-transparent hover:border-brand-primary-accent/50 focus:outline-none;
        }
        .tab-button.active-tab {
            @apply text-brand-primary-dark border-brand-primary-dark/80;
        }
        .tab-content {
            @apply transition-opacity duration-300;
        }
        
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-primary-dark': '#38761D',      /* Primary Accent Dark Green */
                        'brand-primary-accent': '#6AA84F',   /* Highlight Medium Green */
                        'brand-card-bg': '#FAF0E6',          /* Light Card Background (Creamy Tan) */
                        'brand-bg': '#FFFCF5',               /* Main Background (Soft White/Cream) */
                        'brand-text': '#2C3A2F',             /* Dark Green/Grey Text */
                        'brand-subtle-text': '#60735E',      /* Muted Green/Grey for description */
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-brand-bg font-sans text-brand-text antialiased">

    <nav id="navbar" class="bg-brand-bg/90 backdrop-blur-sm sticky top-0 z-50 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="font-bold text-2xl text-brand-primary-dark transition duration-300 hover:scale-105">тЬи RemedySense</span>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <select id="language-selector" class="bg-brand-card-bg text-brand-primary-dark border border-brand-primary-accent/50 rounded-full text-sm font-medium py-2 pl-3 pr-10 appearance-none cursor-pointer focus:ring-2 focus:ring-brand-primary-accent focus:outline-none">
                            <option value="en">English (EN)</option>
                            <option value="ta">родрооро┐ро┤рпН (TA)</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-brand-primary-dark">
                            <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                        </div>
                    </div>
                    
                    <div class="hidden md:flex items-center space-x-4">
                        <a href="#about" class="nav-link text-brand-subtle-text hover:text-brand-primary-accent px-3 py-2 rounded-md text-sm font-medium transition duration-200" data-translate="nav_about">About</a>
                        <a href="#dashboard" class="nav-link text-brand-subtle-text hover:text-brand-primary-accent px-3 py-2 rounded-md text-sm font-medium transition duration-200" data-translate="nav_dashboard">Dashboard</a>
                        <a href="#remedy-center" class="nav-link text-brand-subtle-text hover:text-brand-primary-accent px-3 py-2 rounded-md text-sm font-medium transition duration-200" data-translate="nav_remedies">Remedies</a>
                        <a href="#screenshots" class="nav-link text-brand-subtle-text hover:text-brand-primary-accent px-3 py-2 rounded-md text-sm font-medium transition duration-200" data-translate="nav_walkthrough">Walkthrough</a>
                        <a href="#" target="_blank" class="bg-brand-primary-accent hover:bg-brand-primary-dark text-white px-4 py-2 rounded-full text-sm font-medium transition duration-300 shadow-lg" data-translate="nav_view_project">View Project</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main>
        <section id="hero-section" class="text-center py-24 px-4 sm:px-6 lg:px-8 bg-brand-bg">
            <div class="max-w-4xl mx-auto">
                <h1 id="hero-title" class="text-4xl md:text-6xl font-extrabold text-brand-primary-dark tracking-tighter" data-translate="hero_title">Your Blend for Better Skin.</h1>
                <p id="hero-subtitle" class="mt-6 text-lg md:text-xl text-brand-subtle-text max-w-3xl mx-auto" data-translate="hero_subtitle">RemedySense is a smart recommender system that moves beyond generic advice, offering natural, effective remedies tailored to your unique skin profile.</p>
                <div class="mt-8 flex justify-center gap-4">
                    <a href="RemedySense_Report.pdf" target="_blank" id="report-link" class="bg-brand-primary-accent hover:bg-brand-primary-dark text-white font-bold py-3 px-8 rounded-full transition duration-300 shadow-xl transform hover:scale-[1.02] active:scale-95" data-translate="hero_report">View Full Report</a>
                    <a href="#remedy-center" id="remedy-link" class="bg-brand-card-bg hover:bg-white text-brand-primary-dark font-bold py-3 px-8 rounded-full transition duration-300 shadow-md border border-brand-primary-accent/50" data-translate="hero_find_remedy">Find Your Remedy</a>
                </div>
            </div>
        </section>

        <section id="about" class="py-20 bg-white fade-in-up">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 id="about-title" class="text-3xl font-bold text-brand-text gradient-text" data-translate="about_title">The Personalized Recommendation Flow</h2>
                    <p id="about-subtitle" class="mt-4 text-lg text-brand-subtle-text" data-translate="about_subtitle">How RemedySense analyzes your skin profile and recommends the most effective natural remedies.</p>
                </div>
                
                <div class="hidden md:grid md:grid-cols-[1fr_50px_1fr_50px_1fr] items-stretch gap-4 max-w-5xl mx-auto">
                    
                    <div class="flow-step-card bg-brand-card-bg card-lift">
                        <div class="text-4xl mb-3 font-extrabold text-brand-primary-accent">1</div>
                        <h3 class="text-xl font-semibold mb-2 text-brand-text" data-translate="flow_step_1_title">INPUT: Image Capture</h3>
                        <p class="text-brand-subtle-text text-sm" data-translate="flow_step_1_desc">The user captures a high-resolution image of the affected skin area (or selects from the dashboard).</p>
                    </div>

                    <div class="flow-arrow-desktop">тЖТ</div>

                    <div class="flow-step-card bg-white card-lift">
                        <div class="text-4xl mb-3 font-extrabold text-brand-primary-accent">2</div>
                        <h3 class="text-xl font-semibold mb-2 text-brand-text" data-translate="flow_step_2_title">PROCESS: Predict Properties</h3>
                        <p class="text-brand-subtle-text text-sm" data-translate="flow_step_2_desc">A Decision Tree Model analyzes the image data to predict the required therapeutic properties: Anti-inflammatory and Antioxidant levels.</p>
                    </div>

                    <div class="flow-arrow-desktop">тЖТ</div>

                    
                    <div class="flow-step-card bg-brand-card-bg card-lift">
                        <div class="text-4xl mb-3 font-extrabold text-brand-primary-accent">3</div>
                        <h3 class="text-xl font-semibold mb-2 text-brand-text" data-translate="flow_step_3_title">OUTPUT: Generate Remedy</h3>
                        <p class="text-brand-subtle-text text-sm" data-translate="flow_step_3_desc">The system matches the required properties to its ingredient database and delivers a Tailored Remedy with full instructions.</p>
                    </div>
                </div>
                
                <div class="md:hidden space-y-4 max-w-sm mx-auto">
                    <div class="flow-step-card bg-brand-card-bg">
                        <div class="text-4xl mb-3 font-extrabold text-brand-primary-accent">1</div>
                        <h3 class="text-xl font-semibold mb-2 text-brand-text" data-translate="flow_step_1_title">INPUT: Image Capture</h3>
                        <p class="text-brand-subtle-text text-sm" data-translate="flow_step_1_desc">The user captures a high-resolution image of the affected skin area (or selects from the dashboard).</p>
                    </div>
                    <div class="flow-arrow-mobile text-4xl">тЖУ</div>
                    <div class="flow-step-card bg-white">
                        <div class="text-4xl mb-3 font-extrabold text-brand-primary-accent">2</div>
                        <h3 class="text-xl font-semibold mb-2 text-brand-text" data-translate="flow_step_2_title">PROCESS: Predict Properties</h3>
                        <p class="text-brand-subtle-text text-sm" data-translate="flow_step_2_desc">A Decision Tree Model analyzes the image data to predict the required therapeutic properties: Anti-inflammatory and Antioxidant levels.</p>
                    </div>
                    <div class="flow-arrow-mobile text-4xl">тЖУ</div>
                    <div class="flow-step-card bg-brand-card-bg">
                        <div class="text-4xl mb-3 font-extrabold text-brand-primary-accent">3</div>
                        <h3 class="text-xl font-semibold mb-2 text-brand-text" data-translate="flow_step_3_title">OUTPUT: Generate Remedy</h3>
                        <p class="text-brand-subtle-text text-sm" data-translate="flow_step_3_desc">The system matches the required properties to its ingredient database and delivers a Tailored Remedy with full instructions.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="dashboard" class="py-20 bg-brand-card-bg fade-in-up">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 id="dashboard-title" class="text-3xl font-bold text-brand-text gradient-text" data-translate="dashboard_title">Interactive Dashboard</h2>
                    <p id="dashboard-subtitle" class="mt-4 text-lg text-brand-subtle-text" data-translate="dashboard_subtitle">Explore the data that powers RemedySense. Filter through our database of powerful, natural ingredients.</p>
                </div>
                <div class="grid lg:grid-cols-5 gap-8">
                    <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-xl card-lift">
                        <h3 id="chart-title" class="text-xl font-semibold text-center mb-4 text-brand-primary-dark" data-translate="chart_title">Common Skin Concerns</h3>
                        <div class="chart-container">
                            <canvas id="skinConcernsChart"></canvas>
                        </div>
                         <p id="chart-caption" class="text-xs text-gray-400 text-center mt-4" data-translate="chart_caption">This chart shows a sample distribution of common skin issues reported by users, highlighting the areas where RemedySense provides the most guidance.</p>
                    </div>
                    <div class="lg:col-span-3 bg-white p-6 rounded-xl shadow-xl card-lift">
                        <h3 id="explorer-title" class="text-xl font-semibold text-center mb-4 text-brand-primary-dark" data-translate="explorer_title">Natural Ingredient Explorer</h3>
                        <div id="ingredient-filters" class="flex flex-wrap justify-center gap-2 mb-6">
                            </div>
                        <div id="ingredient-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                            </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="remedy-center" class="py-20 bg-brand-bg fade-in-up">
            <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 id="remedy-center-title" class="text-3xl font-bold text-brand-text gradient-text" data-translate="remedy_center_title">ЁЯМ┐ Find Your Tailored Remedy</h2>
                    <p id="remedy-center-subtitle" class="mt-4 text-lg text-brand-subtle-text" data-translate="remedy_center_subtitle">Select an input method below to receive a customized, natural remedy instantly.</p>
                </div>

                <div class="bg-white p-6 rounded-2xl shadow-2xl border-2 border-brand-primary-accent/20">
                    
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-bold text-brand-primary-dark" data-translate="input_method_heading">Choose Your Input Method</h3>
                    </div>

                    <div id="input-tabs" class="flex justify-center border-b border-brand-primary-accent/50 mb-6">
                        <button data-tab="issue" class="tab-button active-tab text-brand-primary-dark font-semibold py-2 px-4 transition duration-200 border-b-2 border-brand-primary-dark/80" data-translate="tab_issue_name">Issue Name</button>
                        <button data-tab="camera" class="tab-button text-brand-subtle-text font-semibold py-2 px-4 transition duration-200" data-translate="tab_live_camera">Live Camera</button>
                        <button data-tab="sample" class="tab-button text-brand-subtle-text font-semibold py-2 px-4 transition duration-200" data-translate="tab_sample_image">Sample Image</button>
                    </div>
                    
                    <div id="tab-content-issue" class="tab-content">
                        <div class="mb-8 p-4 bg-brand-card-bg rounded-xl shadow-inner border border-brand-primary-accent/30">
                            <p id="issue-selector-heading" class="text-lg font-bold text-brand-primary-dark mb-4 text-center" data-translate="issue_selector_heading_direct">1. Select Your Issue for Instant Remedy (Bypasses Simulation)</p>
                            <div id="issue-selector" class="grid grid-cols-2 md:grid-cols-5 gap-3">
                            </div>
                        </div>
                    </div>

                    <div id="tab-content-camera" class="tab-content hidden">
                        <div class="mt-6 border-t pt-4 border-brand-subtle-text/30">
                            <div class="p-2 rounded-lg bg-brand-primary-accent/10">
                                <p id="camera-heading" class="text-lg font-semibold text-brand-primary-dark text-center" data-translate="camera_heading_live">Live Camera Analysis Simulation</p>
                            </div>

                            <div id="camera-content" class="p-4">
                                <p id="webcam-status" class="text-sm text-brand-primary-dark bg-brand-card-bg p-2 rounded-lg transition duration-300 text-center mb-4"></p>

                                <div class="flex flex-col md:flex-row justify-center items-start gap-8">
                                    <div class="flex-1 w-full flex flex-col items-center">
                                        <h4 id="live-feed-heading" class="font-bold text-md mb-2" data-translate="live_feed_heading">Live Feed (Selfie View)</h4>
                                        <video id="video-feed" autoplay playsinline></video>
                                        <canvas id="captureCanvas" class="hidden"></canvas> 
                                    </div>
                                    
                                    <div class="flex-1 w-full flex flex-col items-center">
                                        <h4 id="capture-heading" class="font-bold text-md mb-2" style="display: none;" data-translate="capture_frame_heading">Captured Frame</h4>
                                        <img id="captured-image" alt="Captured Webcam Frame" />
                                    </div>
                                </div>

                                <div class="flex flex-col sm:flex-row gap-4 justify-center mt-6">
                                    <button id="startButton" class="w-full sm:w-auto px-6 py-3 bg-brand-primary-accent text-white font-bold rounded-full transition duration-300 shadow-xl transform hover:scale-[1.02] active:scale-95" data-translate="start_button">
                                        Start Camera
                                    </button>
                                    <button id="captureButton" class="w-full sm:w-auto px-6 py-3 bg-gray-400 text-white font-bold rounded-full transition duration-300 shadow-md" disabled data-translate="capture_button">
                                        Capture Frame & Simulate Analysis
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="tab-content-sample" class="tab-content hidden">
                        <div class="mt-6 border-t pt-4 border-brand-subtle-text/30">
                            <div class="p-2 rounded-lg bg-brand-primary-accent/10">
                                <p id="sample-heading" class="text-lg font-semibold text-brand-primary-dark text-center" data-translate="sample_heading_simulate">Sample Image Analysis Simulation</p>
                            </div>
                            <div id="sample-image-selector" class="mt-4 p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <p class="text-md font-bold text-brand-primary-dark mb-3 text-center" data-translate="sample_image_heading">Click to Select a Sample Image for Analysis</p>
                                <div id="sample-image-grid" class="grid grid-cols-3 md:grid-cols-5 gap-3">
                                    </div>
                                <p class="text-xs text-red-600 mt-3 text-center hidden" id="sample-error-message"></p>
                            </div>
                        </div>
                    </div>

                    <div id="remedy-results" class="mt-8 p-6 bg-brand-card-bg rounded-2xl shadow-2xl border-t-4 border-brand-primary-accent hidden">
                        <div class="mb-6 pb-4 border-b border-brand-primary-dark/20">
                            <h3 class="text-2xl font-bold mb-2 text-brand-primary-dark" id="result-issue-title"></h3>
                            <p class="text-brand-subtle-text" id="result-issue-description"></p>
                        </div>

                        <div class="grid lg:grid-cols-2 gap-8">
                            <div id="remedy-1-container" class="p-5 border border-brand-primary-accent/30 rounded-xl shadow-inner bg-white">
                                </div>
                            <div id="remedy-2-container" class="p-5 border border-brand-primary-accent/30 rounded-xl shadow-inner bg-white">
                                 </div>
                        </div>
                    </div>
                    <div id="error-message" class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg hidden"></div>
                </div>
            </div>
        </section>

        <section id="screenshots" class="py-20 bg-brand-card-bg fade-in-up">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-12">
                    <h2 id="screenshots-title" class="text-3xl font-bold text-brand-text gradient-text" data-translate="screenshots_title">Application in Action</h2>
                    <p id="screenshots-subtitle" class="mt-4 text-lg text-brand-subtle-text" data-translate="screenshots_subtitle">A visual walkthrough of the RemedySense user experience, from input to recommendation.</p>
                </div>
                <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div class="bg-white rounded-xl shadow-xl overflow-hidden card-lift">
                        <img src="https://placehold.co/600x400/38761D/FFFCF5?text=1.+ISSUE+IDENTIFIER%0A%0A%E2%9C%85+Select+from+9+Common+Issues" alt="User Input Screen" class="w-full h-48 object-cover">
                        <div class="p-6">
                            <h3 class="font-semibold text-brand-primary-dark" data-translate="screenshot_1_title">1. Issue Identifier Selection</h3>
                            <p class="text-sm text-brand-subtle-text mt-2" data-translate="screenshot_1_desc">Users can quickly select their primary skin concern from a set of common conditions.</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-xl overflow-hidden card-lift">
                        <img src="https://placehold.co/600x400/6AA84F/2C3A2F?text=2.+MODEL+PREDICTS%0A%0A%E2%9C%85+Properties+%26+Top+Ingredients" alt="Results Screen" class="w-full h-48 object-cover">
                        <div class="p-6">
                            <h3 class="font-semibold text-brand-primary-dark" data-translate="screenshot_2_title">2. Recommendation Results</h3>
                            <p class="text-sm text-brand-subtle-text mt-2" data-translate="screenshot_2_desc">A clear, ranked list of suggested remedies based on the user's profile or selected issue.</p>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-xl overflow-hidden card-lift">
                        <img src="https://placehold.co/600x400/38761D/FFFCF5?text=3.+REMEDY+DELIVERED%0A%0A%E2%9C%85+Instructions+%26+Benefits" alt="Details Screen" class="w-full h-48 object-cover">
                        <div class="p-6">
                            <h3 class="font-semibold text-brand-primary-dark" data-translate="screenshot_3_title">3. Detailed Remedy Information</h3>
                            <p class="text-sm text-brand-subtle-text mt-2" data-translate="screenshot_3_desc">Each recommendation includes benefits, ingredients, and step-by-step instructions.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <footer class="bg-brand-primary-dark text-brand-card-bg">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 text-center">
            <p id="footer-text" data-translate="footer_text">2025 RemedySense Project.</p>
        </div>
    </footer>

    <script>
        // --- GLOBALS ---
        let currentLang = 'en';
        let currentIssueKey = null; // Stores the issue selected by ANY method
        let stream = null; // Global stream variable for webcam access

        // --- DOM ELEMENTS ---
        let video = document.getElementById('video-feed');
        let captureCanvas = document.getElementById('captureCanvas');
        let capturedImage = document.getElementById('captured-image');
        let startButton = document.getElementById('startButton');
        let captureButton = document.getElementById('captureButton');
        let webcamStatusEl = document.getElementById('webcam-status');
        let remedyResultsEl = document.getElementById('remedy-results');
        
        // --- TRANSLATION DATA ---
        const translations = {
            en: {
                app_title: "RemedySense Interactive Project Showcase (Earthy Green Theme)",
                nav_about: "About",
                nav_dashboard: "Dashboard",
                nav_remedies: "Remedies",
                nav_walkthrough: "Walkthrough",
                nav_view_project: "View Project",
                hero_title: "Your Blend for Better Skin.",
                hero_subtitle: "RemedySense is a smart recommender system that moves beyond generic advice, offering natural, effective remedies tailored to your unique skin profile.",
                hero_report: "View Full Report",
                hero_find_remedy: "Find Your Remedy",
                about_title: "The Personalized Recommendation Flow",
                about_subtitle: "How RemedySense analyzes your skin profile and recommends the most effective natural remedies.",
                flow_step_1_title: "INPUT: Image Capture",
                flow_step_1_desc: "The user captures a high-resolution image of the affected skin area (or selects from the dashboard).",
                flow_step_2_title: "PROCESS: Predict Properties",
                flow_step_2_desc: "A Decision Tree Model analyzes the image data to predict the required therapeutic properties: Anti-inflammatory and Antioxidant levels.",
                flow_step_3_title: "OUTPUT: Generate Remedy",
                flow_step_3_desc: "The system matches the required properties to its ingredient database and delivers a Tailored Remedy with full instructions.",
                dashboard_title: "Interactive Dashboard",
                dashboard_subtitle: "Explore the data that powers RemedySense. Filter through our database of powerful, natural ingredients.",
                chart_title: "Common Skin Concerns",
                chart_caption: "This chart shows a sample distribution of common skin issues reported by users, highlighting the areas where RemedySense provides the most guidance.",
                explorer_title: "Natural Ingredient Explorer",
                filter_all: "All",
                filter_anti_inflammatory: "Anti-inflammatory",
                filter_antioxidant: "Antioxidant",
                filter_moisturizing: "Moisturizing",
                remedy_center_title: "ЁЯМ┐ Find Your Tailored Remedy",
                remedy_center_subtitle: "Select an input method below to receive a customized, natural remedy instantly.",
                
                // NEW TAB & HEADING TRANSLATIONS
                input_method_heading: "Choose Your Input Method",
                tab_issue_name: "Issue Name",
                tab_live_camera: "Live Camera",
                tab_sample_image: "Sample Image",
                issue_selector_heading_direct: "1. Select Your Issue for Instant Remedy (Bypasses Simulation)",
                camera_heading_live: "Live Camera Analysis Simulation",
                sample_heading_simulate: "Sample Image Analysis Simulation",
                // END NEW

                live_feed_heading: "Live Feed (Selfie View)",
                capture_frame_heading: "Captured Frame",
                start_button: "Start Camera",
                capture_button: "Capture Frame & Simulate Analysis",
                sample_image_heading: "Click to Select a Sample Image for Analysis", 

                status_initial: "Please select an input method above to begin the remedy recommendation process.",
                status_issue_selected_direct: (issueName) => `Remedy found for **${issueName}**! See results below.`,
                status_start_attempt: "Attempting to access camera... Please grant permission.",
                status_camera_active: (issueName) => `Camera active. **${issueName}** is set for simulation. Click **Capture Frame** to simulate analysis.`,
                status_camera_stopped: (issueName) => `Issue set to: **${issueName}**. Camera stopped. Click 'Start Camera' to re-enable.`,
                status_capture_simulated: (issueName) => `Image captured. Simulating model prediction: **${issueName}** confirmed. See results below.`,
                status_error_general: "An unknown error occurred while accessing the camera.",
                status_error_denied: "Permission Denied: You blocked camera access. Please check your browser settings and try again.",
                status_error_not_found: "Camera Not Found: No video input device (webcam) was detected.",
                status_error_not_readable: "Camera Not Readable: Your camera might be in use by another application.",
                status_error_stream_inactive: "Error: Camera stream is not active. Click 'Start Camera'.",
                status_error_no_issue_selected: "Error: Please first select an **Issue Name** to define the model's simulated prediction.",

                remedy_key_ingredients: "Key Ingredients:",
                remedy_instructions: "Application Instructions:",
                remedy_not_found: (issueKey) => `No expert remedies found for the analyzed issue (${issueKey}).`,
                screenshots_title: "Application in Action",
                screenshots_subtitle: "A visual walkthrough of the RemedySense user experience, from input to recommendation.",
                screenshot_1_title: "1. Issue Identifier Selection",
                screenshot_1_desc: "Users can quickly select their primary skin concern from a set of common conditions.",
                screenshot_2_title: "2. Recommendation Results",
                screenshot_2_desc: "A clear, ranked list of suggested remedies based on the user's profile or selected issue.",
                screenshot_3_title: "3. Detailed Remedy Information",
                screenshot_3_desc: "Each recommendation includes benefits, ingredients, and step-by-step instructions.",
                footer_text: "2025 RemedySense Project.", 
                // Issue Labels
                issue_acne: "Acne & Blemishes",
                issue_dryness: "Dryness & Dehydration",
                issue_redness: "Redness & Irritation",
                issue_oily: "Oily Skin & Pores",
                issue_cloggedpores: "Clogged Pores (Whiteheads & Blackheads)", 
                issue_darkspots: "Dark Spots & PIH",
                issue_lines: "Fine Lines & Wrinkles",
                issue_eczema: "Eczema & Itch",
                issue_sunburn: "Sunburn Relief",
                
                // --- DYNAMIC CONTENT KEYS ---
                // Property Keys
                prop_anti_inflammatory: "Anti-inflammatory",
                prop_antioxidant: "Antioxidant",
                prop_moisturizing: "Moisturizing", 
                prop_antibacterial: "Antibacterial", 

                // Ingredient Names & Descriptions (Partial for brevity)
                ing_aloe_vera: "Aloe Vera",
                ing_tea_tree: "Tea Tree Oil",
                ing_turmeric: "Turmeric",
                ing_honey: "Honey",
                
                // Placeholder descriptions for remedies (required by viewExpertRemedy)
                desc_acne: "This recommendation addresses inflammation and bacterial activity associated with breakouts.",
                remedy_acne_1_name: "Tea Tree Spot Treatment",
                remedy_acne_1_desc: "A potent blend for targeted relief and reducing swelling.",
                remedy_acne_1_inst_1: "Mix 2 drops of Tea Tree Oil with 1 tablespoon of Aloe Vera Gel.",
                remedy_acne_1_inst_2: "Apply directly to blemishes using a cotton swab.",
                remedy_acne_1_inst_3: "Leave on for 15 minutes then rinse. Use once daily.",
                remedy_acne_2_name: "Turmeric & Honey Mask",
                remedy_acne_2_desc: "A soothing mask that fights bacteria and evens skin tone.",
                remedy_acne_2_inst_1: "Combine 1 teaspoon of Turmeric powder and 1 tablespoon of raw Honey.",
                remedy_acne_2_inst_2: "Apply evenly to the affected area.",
                remedy_acne_2_inst_3: "Leave on for 20 minutes before washing off with lukewarm water."
            },
            ta: { 
                // Tamil Translations (Partial for brevity)
                app_title: "ро░рпЖроорпЖроЯро┐роЪрпЖройрпНро╕рпН роКроЯро╛роЯрпБроорпН родро┐роЯрпНроЯроХрпН роХро╛роЯрпНроЪро┐ (рокроЪрпНроЪрпИ родрпАроорпН)", 
                nav_about: "рокро▒рпНро▒ро┐", nav_dashboard: "роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯрпБрокрпН рокро▓роХрпИ", nav_remedies: "роЪро┐роХро┐роЪрпНроЪрпИроХро│рпН", nav_walkthrough: "ро╡ро┤ро┐роорпБро▒рпИ", nav_view_project: "родро┐роЯрпНроЯродрпНродрпИроХрпН роХро╛рогрпНроХ", 
                hero_title: "роЪро┐ро▒роирпНрод роЪро░рпБроородрпНродро┐ро▒рпНроХро╛рой роЙроЩрпНроХро│рпН роХро▓ро╡рпИ.", 
                hero_subtitle: "ро░рпЖроорпЖроЯро┐роЪрпЖройрпНро╕рпН роОройрпНрокродрпБ роЙроЩрпНроХро│рпН родройро┐родрпНродрпБро╡рооро╛рой родрпЛро▓рпН роЪрпБропро╡ро┐ро╡ро░родрпНродро┐ро▒рпНроХрпБ роПро▒рпНро▒ роЗропро▒рпНроХрпИропро╛рой, рокропройрпБро│рпНро│ родрпАро░рпНро╡рпБроХро│рпИ ро╡ро┤роЩрпНроХрпБроорпН роТро░рпБ ро╕рпНрооро╛ро░рпНроЯрпН рокро░ро┐роирпНродрпБро░рпИ роЕроорпИрокрпНрокрпБ.", 
                hero_report: "роорпБро┤рпБ роЕро▒ро┐роХрпНроХрпИропрпИроХрпН роХро╛рогрпНроХ", hero_find_remedy: "роЙроЩрпНроХро│рпН роЪро┐роХро┐роЪрпНроЪрпИропрпИроХрпН роХрогрпНроЯро▒ро┐ропро╡рпБроорпН", 
                about_title: "родройро┐рокрпНрокропройро╛роХрпНроХрокрпНрокроЯрпНроЯ рокро░ро┐роирпНродрпБро░рпИ роУроЯрпНроЯроорпН", 
                about_subtitle: "ро░рпЖроорпЖроЯро┐роЪрпЖройрпНро╕рпН роЙроЩрпНроХро│рпН родрпЛро▓рпН роЪрпБропро╡ро┐ро╡ро░родрпНродрпИ роОро╡рпНро╡ро╛ро▒рпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНродрпБ рооро┐роХро╡рпБроорпН рокропройрпБро│рпНро│ роЗропро▒рпНроХрпИ роЪро┐роХро┐роЪрпНроЪрпИроХро│рпИ рокро░ро┐роирпНродрпБро░рпИроХрпНроХро┐ро▒родрпБ.", 
                flow_step_1_title: "роЙро│рпНро│рпАроЯрпБ: рокроЯродрпНродрпИрокрпН рокро┐роЯро┐роХрпНроХро╡рпБроорпН", 
                flow_step_1_desc: "рокропройро░рпН рокро╛родро┐роХрпНроХрокрпНрокроЯрпНроЯ родрпЛро▓рпН рокроХрпБродро┐ропро┐ройрпН роЙропро░рпНродро░рокрпН рокроЯродрпНродрпИрокрпН рокро┐роЯро┐роХрпНроХро┐ро▒ро╛ро░рпН (роЕро▓рпНро▓родрпБ роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯрпБрокрпН рокро▓роХрпИропро┐ро▓рпН роЗро░рпБроирпНродрпБ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро┐ро▒ро╛ро░рпН).", 
                flow_step_2_title: "роЪрпЖропро▓рпНроорпБро▒рпИ: рокрогрпНрокрпБроХро│рпИроХрпН роХрогро┐роХрпНроХро╡рпБроорпН", 
                flow_step_2_desc: "роТро░рпБ роорпБроЯро┐ро╡рпБ рооро░ рооро╛родро┐ро░ро┐ (Decision Tree Model) рокроЯродрпНродро┐ройрпН родро░ро╡рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНродрпБ родрпЗро╡рпИропро╛рой роЪро┐роХро┐роЪрпНроЪрпИ рокрогрпНрокрпБроХро│рпИроХрпН роХрогро┐роХрпНроХро┐ро▒родрпБ: роЕро┤ро▒рпНроЪро┐ роОродро┐ро░рпНрокрпНрокрпБ рооро▒рпНро▒рпБроорпН роЖроХрпНро╕ро┐роЬройрпЗро▒рпНро▒ роЕро│ро╡рпБроХро│рпН.", 
                flow_step_3_title: "ро╡рпЖро│ро┐ропрпАроЯрпБ: роЪро┐роХро┐роЪрпНроЪрпИропрпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН", 
                flow_step_3_desc: "роЕроорпИрокрпНрокрпБ родрпЗро╡рпИропро╛рой рокрогрпНрокрпБроХро│рпИ роЕродройрпН роорпВро▓рокрпНрокрпКро░рпБро│рпН родро░ро╡рпБродрпНродро│родрпНродрпБроЯройрпН рокрпКро░рпБродрпНродро┐, роорпБро┤рпБроорпИропро╛рой ро╡ро┤ро┐роорпБро▒рпИроХро│рпБроЯройрпН роТро░рпБ родройро┐рокрпНрокропройро╛роХрпНроХрокрпНрокроЯрпНроЯ роЪро┐роХро┐роЪрпНроЪрпИропрпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ.", 
                dashboard_title: "роКроЯро╛роЯрпБроорпН роХроЯрпНроЯрпБрокрпНрокро╛роЯрпНроЯрпБрокрпН рокро▓роХрпИ", 
                dashboard_subtitle: "ро░рпЖроорпЖроЯро┐роЪрпЖройрпНро╕рпИ роЗропроХрпНроХрпБроорпН родро░ро╡рпБроХро│рпИ роЖро░ро╛ропрпБроЩрпНроХро│рпН. роЪроХрпНродро┐ро╡ро╛ропрпНроирпНрод, роЗропро▒рпНроХрпИропро╛рой роорпВро▓рокрпНрокрпКро░рпБроЯрпНроХро│ро┐ройрпН роОроЩрпНроХро│рпН родро░ро╡рпБродрпНродро│родрпНродро┐ройрпН роорпВро▓роорпН ро╡роЯро┐роХроЯрпНроЯро╡рпБроорпН.", 
                chart_title: "рокрпКродрпБро╡ро╛рой родрпЛро▓рпН роХро╡ро▓рпИроХро│рпН", 
                chart_caption: "роЗроирпНрод ро╡ро┐ро│роХрпНроХрокрпНрокроЯроорпН рокропройро░рпНроХро│ро╛ро▓рпН родрпЖро░ро┐ро╡ро┐роХрпНроХрокрпНрокроЯрпНроЯ рокрпКродрпБро╡ро╛рой родрпЛро▓рпН рокро┐ро░роЪрпНроЪро┐ройрпИроХро│ро┐ройрпН рооро╛родро┐ро░ро┐ ро╡ро┐роиро┐ропрпЛроХродрпНродрпИроХрпН роХро╛роЯрпНроЯрпБроХро┐ро▒родрпБ, роЕроЩрпНроХрпБ ро░рпЖроорпЖроЯро┐роЪрпЖройрпНро╕рпН роЕродро┐роХ ро╡ро┤ро┐роХро╛роЯрпНроЯрпБродро▓рпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ.", 
                explorer_title: "роЗропро▒рпНроХрпИ роорпВро▓рокрпНрокрпКро░рпБро│рпН роЖропрпНро╡ро┐", 
                filter_all: "роЕройрпИродрпНродрпБроорпН", 
                filter_anti_inflammatory: "роЕро┤ро▒рпНроЪро┐ роОродро┐ро░рпНрокрпНрокрпБ", 
                filter_antioxidant: "роЖроХрпНро╕ро┐роЬройрпЗро▒рпНро▒",
                filter_moisturizing: "роИро░рокрпНрокродрооро╛роХрпНроХрпБроорпН",
                remedy_center_title: "ЁЯМ┐ роЙроЩрпНроХро│рпН родройро┐рокрпНрокропройро╛роХрпНроХрокрпНрокроЯрпНроЯ роЪро┐роХро┐роЪрпНроЪрпИропрпИроХрпН роХрогрпНроЯро▒ро┐ропро╡рпБроорпН",
                remedy_center_subtitle: "роЙроЯройроЯро┐ропро╛роХ родройро┐рокрпНрокропройро╛роХрпНроХрокрпНрокроЯрпНроЯ, роЗропро▒рпНроХрпИропро╛рой роЪро┐роХро┐роЪрпНроЪрпИропрпИрокрпН рокрпЖро▒ роХрпАро┤рпЗ роТро░рпБ роЙро│рпНро│рпАроЯрпНроЯрпБ роорпБро▒рпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.",
                
                // NEW TAB & HEADING TRANSLATIONS
                input_method_heading: "роЙроЩрпНроХро│рпН роЙро│рпНро│рпАроЯрпНроЯрпБ роорпБро▒рпИропрпИродрпН родрпЗро░рпНро╡рпБроЪрпЖропрпНроХ",
                tab_issue_name: "роЪро┐роХрпНроХро▓рпН рокрпЖропро░рпН",
                tab_live_camera: "роирпЗро░роЯро┐ роХрпЗрооро░ро╛",
                tab_sample_image: "рооро╛родро┐ро░ро┐ рокроЯроорпН",
                issue_selector_heading_direct: "1. роЙроЯройроЯро┐ роЪро┐роХро┐роЪрпНроЪрпИроХрпНроХро╛роХ роЙроЩрпНроХро│рпН роЪро┐роХрпНроХро▓рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН (роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродрпБродро▓рпИродрпН родро╡ро┐ро░рпНроХрпНроХро┐ро▒родрпБ)",
                camera_heading_live: "роирпЗро░роЯро┐ роХрпЗрооро░ро╛ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродрпБродро▓рпН",
                sample_heading_simulate: "рооро╛родро┐ро░ро┐ рокроЯ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродрпБродро▓рпН",
                // END NEW

                live_feed_heading: "роирпЗро░роЯро┐ роКроЯрпНроЯро▓рпН (роЪрпЖро▓рпНроГрокро┐ рокро╛ро░рпНро╡рпИ)",
                capture_frame_heading: "рокро┐роЯро┐роХрпНроХрокрпНрокроЯрпНроЯ роЪроЯрпНроЯроХроорпН",
                start_button: "роХрпЗрооро░ро╛ро╡рпИродрпН родрпКроЯроЩрпНроХрпБ",
                capture_button: "роЪроЯрпНроЯроХродрпНродрпИрокрпН рокро┐роЯро┐родрпНродрпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродро╡рпБроорпН",
                sample_image_heading: "рокроХрпБрокрпНрокро╛ропрпНро╡рпБроХрпНроХрпБ роТро░рпБ рооро╛родро┐ро░ро┐рокрпН рокроЯродрпНродрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХ роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН",

                status_initial: "роЪро┐роХро┐роЪрпНроЪрпИ рокро░ро┐роирпНродрпБро░рпИ роЪрпЖропро▓рпНроорпБро▒рпИропрпИродрпН родрпКроЯроЩрпНроХ роорпЗро▓рпЗ роТро░рпБ роЙро│рпНро│рпАроЯрпНроЯрпБ роорпБро▒рпИропрпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.",
                status_issue_selected_direct: (issueName) => `**${issueName}**роХрпНроХро╛рой роЪро┐роХро┐роЪрпНроЪрпИ роХро┐роЯрпИродрпНродродрпБ! роорпБроЯро┐ро╡рпБроХро│рпИроХрпН роХрпАро┤рпЗ роХро╛рогрпНроХ.`,
                status_start_attempt: "роХрпЗрооро░ро╛ро╡рпИ роЕрогрпБроХ роорпБропро▒рпНроЪро┐роХрпНроХро┐ро▒родрпБ... роЕройрпБроородро┐ропрпИ ро╡ро┤роЩрпНроХро╡рпБроорпН.",
                status_camera_active: (issueName) => `роХрпЗрооро░ро╛ роЪрпЖропро▓ро┐ро▓рпН роЙро│рпНро│родрпБ. роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродрпБродро▓рпБроХрпНроХро╛роХ **${issueName}** роЕроорпИроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. рокроХрпБрокрпНрокро╛ропрпНро╡рпИ роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНрод **роЪроЯрпНроЯроХродрпНродрпИрокрпН рокро┐роЯро┐роХрпНроХро╡рпБроорпН** роОройрпНрокродрпИроХрпН роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН.`,
                status_camera_stopped: (issueName) => `роЪро┐роХрпНроХро▓рпН роЕроорпИроХрпНроХрокрпНрокроЯрпНроЯродрпБ: **${issueName}**. роХрпЗрооро░ро╛ роиро┐ро▒рпБродрпНродрокрпНрокроЯрпНроЯродрпБ. роорпАрогрпНроЯрпБроорпН роЗропроХрпНроХ 'роХрпЗрооро░ро╛ро╡рпИродрпН родрпКроЯроЩрпНроХрпБ' роОройрпНрокродрпИроХрпН роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН.`,
                status_capture_simulated: (issueName) => `рокроЯроорпН рокро┐роЯро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ. рооро╛родро┐ро░ро┐ роХрогро┐рокрпНрокрпИ роЙро░рпБро╡роХрокрпНрокроЯрпБродрпНродрпБродро▓рпН: **${issueName}** роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯродрпБ. роорпБроЯро┐ро╡рпБроХро│рпИроХрпН роХрпАро┤рпЗ роХро╛рогрпНроХ.`,
                status_error_general: "роХрпЗрооро░ро╛ро╡рпИ роЕрогрпБроХрпБроорпНрокрпЛродрпБ роЕро▒ро┐ропрокрпНрокроЯро╛род рокро┐ро┤рпИ роПро▒рпНрокроЯрпНроЯродрпБ.",
                status_error_denied: "роЕройрпБроородро┐ рооро▒рпБроХрпНроХрокрпНрокроЯрпНроЯродрпБ: роирпАроЩрпНроХро│рпН роХрпЗрооро░ро╛ роЕрогрпБроХро▓рпИродрпН родроЯрпБродрпНродрпАро░рпНроХро│рпН. роЙроЩрпНроХро│рпН роЙро▓ро╛ро╡ро┐ роЕроорпИрокрпНрокрпБроХро│рпИроЪрпН роЪро░ро┐рокро╛ро░рпНродрпНродрпБ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.",
                status_error_not_found: "роХрпЗрооро░ро╛ роХрогрпНроЯрпБрокро┐роЯро┐роХрпНроХрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ: роОроирпНрод ро╡рпАроЯро┐ропрпЛ роЙро│рпНро│рпАроЯрпНроЯрпБ роЪро╛родройроорпБроорпН (ро╡рпЖрокрпНроХрпЗроорпН) роХрогрпНроЯро▒ро┐ропрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.",
                status_error_not_readable: "роХрпЗрооро░ро╛ро╡рпИрокрпН рокроЯро┐роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ: роЙроЩрпНроХро│рпН роХрпЗрооро░ро╛ ро╡рпЗро▒рпБ рокропройрпНрокро╛роЯрпНроЯро┐ройро╛ро▓рпН рокропройрпНрокроЯрпБродрпНродрокрпНрокроЯро▓ро╛роорпН.",
                status_error_stream_inactive: "рокро┐ро┤рпИ: роХрпЗрооро░ро╛ ро╕рпНроЯрпНро░рпАроорпН роЪрпЖропро▓ро┐ро▓рпН роЗро▓рпНро▓рпИ. 'роХрпЗрооро░ро╛ро╡рпИродрпН родрпКроЯроЩрпНроХрпБ' роОройрпНрокродрпИроХрпН роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН.",
                status_error_no_issue_selected: "рокро┐ро┤рпИ: рооро╛родро┐ро░ро┐ роХрогро┐рокрпНрокрпИ ро╡ро░рпИропро▒рпБроХрпНроХ роорпБродро▓ро┐ро▓рпН роТро░рпБ **роЪро┐роХрпНроХро▓рпН рокрпЖропро░рпИродрпН** родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро╡рпБроорпН.",

                remedy_key_ingredients: "роорпБроХрпНроХро┐роп рокрпКро░рпБроЯрпНроХро│рпН:",
                remedy_instructions: "рокропройрпНрокроЯрпБродрпНродрпБроорпН ро╡ро┤ро┐роорпБро▒рпИроХро│рпН:",
                remedy_not_found: (issueKey) => `рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯ роЪро┐роХрпНроХро▓рпБроХрпНроХрпБ (${issueKey}) роиро┐рокрпБрогро░рпН роЪро┐роХро┐роЪрпНроЪрпИроХро│рпН роОродрпБро╡рпБроорпН роХро╛рогрокрпНрокроЯро╡ро┐ро▓рпНро▓рпИ.`,
                screenshots_title: "роЪрпЖропро▓ро┐ро▓рпН роЙро│рпНро│ рокропройрпНрокро╛роЯрпБ",
                screenshots_subtitle: "роЙро│рпНро│рпАроЯрпНроЯро┐ро▓ро┐ро░рпБроирпНродрпБ рокро░ро┐роирпНродрпБро░рпИ ро╡ро░рпИ ро░рпЖроорпЖроЯро┐роЪрпЖройрпНро╕рпН рокропройро░рпН роЕройрпБрокро╡родрпНродро┐ройрпН роХро╛роЯрпНроЪро┐ ро╡ро┤ро┐роорпБро▒рпИ.",
                screenshot_1_title: "1. роЪро┐роХрпНроХро▓рпН роЕроЯрпИропро╛ро│роЩрпНроХро╛роЯрпНроЯро┐ родрпЗро░рпНро╡рпБ",
                screenshot_1_desc: "рокропройро░рпНроХро│рпН рокрпКродрпБро╡ро╛рой роиро┐ро▓рпИроорпИроХро│ро┐ройрпН родрпКроХрпБрокрпНрокро┐ро▓ро┐ро░рпБроирпНродрпБ родроЩрпНроХро│рпН роорпБродройрпНроорпИ родрпЛро▓рпН роХро╡ро▓рпИропрпИ ро╡ро┐ро░рпИро╡ро╛роХродрпН родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХро▓ро╛роорпН.",
                screenshot_2_title: "2. рокро░ро┐роирпНродрпБро░рпИ роорпБроЯро┐ро╡рпБроХро│рпН",
                screenshot_2_desc: "рокропройро░ро┐ройрпН роЪрпБропро╡ро┐ро╡ро░роорпН роЕро▓рпНро▓родрпБ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХрокрпНрокроЯрпНроЯ роЪро┐роХрпНроХро▓ро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпНроЯ роЪро┐роХро┐роЪрпНроЪрпИроХро│ро┐ройрпН родрпЖро│ро┐ро╡ро╛рой, родро░ро╡ро░ро┐роЪрпИрокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ рокроЯрпНроЯро┐ропро▓рпН.",
                screenshot_3_title: "3. ро╡ро┐ро░ро┐ро╡ро╛рой роЪро┐роХро┐роЪрпНроЪрпИ родроХро╡ро▓рпН",
                screenshot_3_desc: "роТро╡рпНро╡рпКро░рпБ рокро░ро┐роирпНродрпБро░рпИропрпБроорпН роиройрпНроорпИроХро│рпН, рокрпКро░рпБроЯрпНроХро│рпН рооро▒рпНро▒рпБроорпН рокроЯро┐рокрпНрокроЯро┐ропро╛рой ро╡ро┤ро┐роорпБро▒рпИроХро│рпИ роЙро│рпНро│роЯроХрпНроХро┐ропродрпБ.",
                footer_text: "2025 ро░рпЖроорпЖроЯро┐роЪрпЖройрпНро╕рпН родро┐роЯрпНроЯроорпН.", 
                // Issue Labels
                issue_acne: "роорпБроХрокрпНрокро░рпБ & роХро▒рпИроХро│рпН", 
                issue_dryness: "ро╡ро▒роЯрпНроЪро┐ & роирпАро░рпН роЗро┤рокрпНрокрпБ", 
                issue_redness: "роЪро┐ро╡родрпНродро▓рпН & роОро░ро┐роЪрпНроЪро▓рпН", 
                issue_oily: "роОрогрпНрогрпЖропрпН родрпЛро▓рпН & родрпБро│рпИроХро│рпН", 
                issue_cloggedpores: "роЕроЯрпИрокроЯрпНроЯ родрпБро│рпИроХро│рпН (ро╡рпЖро│рпНро│рпИ рооро▒рпНро▒рпБроорпН роХро▒рпБрокрпНрокрпБ родро▓рпИроХро│рпН)", 
                issue_darkspots: "роХро░рпБроорпИропро╛рой рокрпБро│рпНро│ро┐роХро│рпН & PIH", 
                issue_lines: "роорпЖро▓рпНро▓ро┐роп роХрпЛроЯрпБроХро│рпН & роЪрпБро░рпБроХрпНроХроЩрпНроХро│рпН", 
                issue_eczema: "родрпЛро▓рпН роЕро░ро┐рокрпНрокрпБ & рокроЯрпИ", 
                issue_sunburn: "ро╡рпЖропро┐ро▓рпН роиро┐ро╡ро╛ро░рогроорпН", 
                // Property Keys
                prop_anti_inflammatory: "роЕро┤ро▒рпНроЪро┐ роОродро┐ро░рпНрокрпНрокрпБ", 
                prop_antioxidant: "роЖроХрпНро╕ро┐роЬройрпЗро▒рпНро▒",
                prop_moisturizing: "роИро░рокрпНрокродрооро╛роХрпНроХрпБроорпН",
                prop_antibacterial: "рокро╛роХрпНроЯрпАро░ро┐ропро╛ роОродро┐ро░рпНрокрпНрокрпБ",
                // Ingredient Names (Partial list for example)
                ing_aloe_vera: "роХро▒рпНро▒ро╛ро┤рпИ", 
                ing_tea_tree: "родрпЗропро┐ро▓рпИ рооро░ роОрогрпНрогрпЖропрпН",
                ing_turmeric: "роороЮрпНроЪро│рпН",
                ing_honey: "родрпЗройрпН",
                // Placeholder descriptions for remedies (required by viewExpertRemedy)
                desc_acne: "роЗроирпНрод рокро░ро┐роирпНродрпБро░рпИ ро╡рпАроХрпНроХроорпН рооро▒рпНро▒рпБроорпН рокро╛роХрпНроЯрпАро░ро┐ропро╛ роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпИ роиро┐ро╡ро░рпНродрпНродро┐ роЪрпЖропрпНроХро┐ро▒родрпБ.",
                remedy_acne_1_name: "родрпЗропро┐ро▓рпИ рооро░рокрпН рокрпБро│рпНро│ро┐ роЪро┐роХро┐роЪрпНроЪрпИ",
                remedy_acne_1_desc: "роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯ роиро┐ро╡ро╛ро░рогроорпН рооро▒рпНро▒рпБроорпН ро╡рпАроХрпНроХродрпНродрпИроХрпН роХрпБро▒рпИрокрпНрокродро▒рпНроХро╛рой роТро░рпБ роЪроХрпНродро┐ро╡ро╛ропрпНроирпНрод роХро▓ро╡рпИ.",
                remedy_acne_1_inst_1: "2 родрпБро│ро┐ родрпЗропро┐ро▓рпИ рооро░ роОрогрпНрогрпЖропрпИ 1 родрпЗроХрпНроХро░рогрпНроЯро┐ роХро▒рпНро▒ро╛ро┤рпИ роЬрпЖро▓рпНро▓рпБроЯройрпН роХро▓роХрпНроХро╡рпБроорпН.",
                remedy_acne_1_inst_2: "рокро░рпБроХрпНроХро│рпН роорпАродрпБ рокро░рпБродрпНродро┐ родрпБрогро┐ропрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роирпЗро░роЯро┐ропро╛роХ родроЯро╡ро╡рпБроорпН.",
                remedy_acne_1_inst_3: "15 роиро┐рооро┐роЯроЩрпНроХро│рпН ро╡ро┐роЯрпНроЯрпБро╡ро┐роЯрпНроЯрпБ роХро┤рпБро╡ро╡рпБроорпН. родро┐ройроорпБроорпН роТро░рпБ роорпБро▒рпИ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН.",
                remedy_acne_2_name: "роороЮрпНроЪро│рпН рооро▒рпНро▒рпБроорпН родрпЗройрпН рооро╛ро╕рпНроХрпН",
                remedy_acne_2_desc: "рокро╛роХрпНроЯрпАро░ро┐ропро╛роХрпНроХро│рпИ роОродро┐ро░рпНродрпНродрпБрокрпН рокрпЛро░ро╛роЯрпБроорпН рооро▒рпНро▒рпБроорпН родрпЛро▓рпН роиро┐ро▒родрпНродрпИ роЪрооройрпН роЪрпЖропрпНропрпБроорпН роТро░рпБ роЗройро┐роорпИропро╛рой рооро╛ро╕рпНроХрпН.",
                remedy_acne_2_inst_1: "1 родрпЗроХрпНроХро░рогрпНроЯро┐ роороЮрпНроЪро│рпН родрпВро│рпН рооро▒рпНро▒рпБроорпН 1 родрпЗроХрпНроХро░рогрпНроЯро┐ роЪрпБродрпНродрооро╛рой родрпЗройрпН роХро▓роХрпНроХро╡рпБроорпН.",
                remedy_acne_2_inst_2: "рокро╛родро┐роХрпНроХрокрпНрокроЯрпНроЯ рокроХрпБродро┐ропро┐ро▓рпН роЪроорооро╛роХ родроЯро╡ро╡рпБроорпН.",
                remedy_acne_2_inst_3: "ро╡рпЖродрпБро╡рпЖродрпБрокрпНрокро╛рой роирпАро░ро┐ро▓рпН роХро┤рпБро╡рпБро╡родро▒рпНроХрпБ роорпБройрпН 20 роиро┐рооро┐роЯроЩрпНроХро│рпН ро╡ро┐роЯрпНроЯрпБро╡ро┐роЯро╡рпБроорпН."
            }
        };

        // --- CORE DATA STRUCTURES --- 
        const chartData = {
            labels: ['Acne & Blemishes', 'Dryness & Dehydration', 'Redness & Irritation', 'Oily Skin & Pores', 'Other'],
            data: [30, 25, 15, 20, 10], // Sample percentage data
        };

        const issues = [
            'issue_acne', 'issue_dryness', 'issue_redness', 'issue_oily', 
            'issue_cloggedpores', 'issue_darkspots', 'issue_lines', 'issue_eczema', 'issue_sunburn'
        ];

        // Ingredient Database (Used in the Explorer)
        const ingredientsData = [
            { key: 'ing_aloe_vera', properties: ['anti_inflammatory', 'moisturizing'] },
            { key: 'ing_tea_tree', properties: ['antibacterial', 'anti_inflammatory'] },
            { key: 'ing_turmeric', properties: ['anti_inflammatory', 'antioxidant', 'antibacterial'] },
            { key: 'ing_honey', properties: ['moisturizing', 'antibacterial'] },
            { key: 'ing_shea_butter', properties: ['moisturizing'] },
            { key: 'ing_green_tea', properties: ['antioxidant', 'anti_inflammatory'] },
            { key: 'ing_oatmeal', properties: ['anti_inflammatory', 'moisturizing'] },
            { key: 'ing_coconut_oil', properties: ['moisturizing'] },
            { key: 'ing_vitamin_c', properties: ['antioxidant'] },
            { key: 'ing_rose_water', properties: ['anti_inflammatory'] },
        ];
        
        // --- SAMPLE IMAGE DATA ---
        const sampleImages = {
            issue_acne: { src: 'https://placehold.co/100x70/6AA84F/fff?text=ACNE' },
            issue_redness: { src: 'https://placehold.co/100x70/C28B38/fff?text=REDNESS' },
            issue_dryness: { src: 'https://placehold.co/100x70/38761D/fff?text=DRYNESS' },
            issue_darkspots: { src: 'https://placehold.co/100x70/60735E/fff?text=SPOTS' },
            issue_sunburn: { src: 'https://placehold.co/100x70/A4C639/fff?text=SUNBURN' },
        };
        // NOTE: In a real deployment, replace placehold.co links with your own hosted, small sample images.

        // Common Remedies Data Structure (Partial for brevity)
        const commonRemedies = {
            'issue_acne': {
                issueDescKey: "desc_acne", 
                remedy1: { 
                    remedyNameKey: "remedy_acne_1_name", 
                    descriptionKey: "remedy_acne_1_desc",
                    keyIngredients: ["ing_tea_tree", "ing_aloe_vera"],
                    instructionsKeys: ["remedy_acne_1_inst_1", "remedy_acne_1_inst_2", "remedy_acne_1_inst_3"],
                    property_match: { anti_inflammatory: 'high', antibacterial: 'high' }
                },
                remedy2: { 
                    remedyNameKey: "remedy_acne_2_name", 
                    descriptionKey: "remedy_acne_2_desc",
                    keyIngredients: ["ing_turmeric", "ing_honey"],
                    instructionsKeys: ["remedy_acne_2_inst_1", "remedy_acne_2_inst_2", "remedy_acne_2_inst_3"],
                    property_match: { anti_inflammatory: 'medium', antibacterial: 'high' }
                }
            },
            // The following entries need to exist for the code not to break, even if empty
            'issue_dryness': { 
                issueDescKey: "desc_acne", // Placeholder
                remedy1: { remedyNameKey: "remedy_acne_1_name", descriptionKey: "remedy_acne_1_desc", keyIngredients: ["ing_aloe_vera"], instructionsKeys: ["remedy_acne_1_inst_1"], property_match: { moisturizing: 'high' }},
                remedy2: { remedyNameKey: "remedy_acne_2_name", descriptionKey: "remedy_acne_2_desc", keyIngredients: ["ing_shea_butter"], instructionsKeys: ["remedy_acne_2_inst_1"], property_match: { moisturizing: 'high' }}
            },
            'issue_redness': { 
                issueDescKey: "desc_acne", 
                remedy1: { remedyNameKey: "remedy_acne_1_name", descriptionKey: "remedy_acne_1_desc", keyIngredients: ["ing_aloe_vera"], instructionsKeys: ["remedy_acne_1_inst_1"], property_match: { anti_inflammatory: 'high' }},
                remedy2: { remedyNameKey: "remedy_acne_2_name", descriptionKey: "remedy_acne_2_desc", keyIngredients: ["ing_green_tea"], instructionsKeys: ["remedy_acne_2_inst_1"], property_match: { anti_inflammatory: 'medium' }}
            },
            'issue_oily': { 
                issueDescKey: "desc_acne", 
                remedy1: { remedyNameKey: "remedy_acne_1_name", descriptionKey: "remedy_acne_1_desc", keyIngredients: ["ing_tea_tree"], instructionsKeys: ["remedy_acne_1_inst_1"], property_match: { antibacterial: 'high' }},
                remedy2: { remedyNameKey: "remedy_acne_2_name", descriptionKey: "remedy_acne_2_desc", keyIngredients: ["ing_rose_water"], instructionsKeys: ["remedy_acne_2_inst_1"], property_match: { anti_inflammatory: 'low' }}
            },
            'issue_cloggedpores': { 
                issueDescKey: "desc_acne", 
                remedy1: { remedyNameKey: "remedy_acne_1_name", descriptionKey: "remedy_acne_1_desc", keyIngredients: ["ing_tea_tree"], instructionsKeys: ["remedy_acne_1_inst_1"], property_match: { antibacterial: 'high' }},
                remedy2: { remedyNameKey: "remedy_acne_2_name", descriptionKey: "remedy_acne_2_desc", keyIngredients: ["ing_turmeric"], instructionsKeys: ["remedy_acne_2_inst_1"], property_match: { antioxidant: 'medium' }}
            },
            'issue_darkspots': { 
                issueDescKey: "desc_acne", 
                remedy1: { remedyNameKey: "remedy_acne_1_name", descriptionKey: "remedy_acne_1_desc", keyIngredients: ["ing_vitamin_c"], instructionsKeys: ["remedy_acne_1_inst_1"], property_match: { antioxidant: 'high' }},
                remedy2: { remedyNameKey: "remedy_acne_2_name", descriptionKey: "remedy_acne_2_desc", keyIngredients: ["ing_turmeric"], instructionsKeys: ["remedy_acne_2_inst_1"], property_match: { antioxidant: 'medium' }}
            },
            'issue_lines': { 
                issueDescKey: "desc_acne", 
                remedy1: { remedyNameKey: "remedy_acne_1_name", descriptionKey: "remedy_acne_1_desc", keyIngredients: ["ing_vitamin_c"], instructionsKeys: ["remedy_acne_1_inst_1"], property_match: { antioxidant: 'high' }},
                remedy2: { remedyNameKey: "remedy_acne_2_name", descriptionKey: "remedy_acne_2_desc", keyIngredients: ["ing_coconut_oil"], instructionsKeys: ["remedy_acne_2_inst_1"], property_match: { moisturizing: 'high' }}
            },
            'issue_eczema': { 
                issueDescKey: "desc_acne", 
                remedy1: { remedyNameKey: "remedy_acne_1_name", descriptionKey: "remedy_acne_1_desc", keyIngredients: ["ing_oatmeal"], instructionsKeys: ["remedy_acne_1_inst_1"], property_match: { anti_inflammatory: 'high' }},
                remedy2: { remedyNameKey: "remedy_acne_2_name", descriptionKey: "remedy_acne_2_desc", keyIngredients: ["ing_shea_butter"], instructionsKeys: ["remedy_acne_2_inst_1"], property_match: { moisturizing: 'high' }}
            },
            'issue_sunburn': { 
                issueDescKey: "desc_acne", 
                remedy1: { remedyNameKey: "remedy_acne_1_name", descriptionKey: "remedy_acne_1_desc", keyIngredients: ["ing_aloe_vera"], instructionsKeys: ["remedy_acne_1_inst_1"], property_match: { anti_inflammatory: 'high' }},
                remedy2: { remedyNameKey: "remedy_acne_2_name", descriptionKey: "remedy_acne_2_desc", keyIngredients: ["ing_green_tea"], instructionsKeys: ["remedy_acne_2_inst_1"], property_match: { antioxidant: 'medium' }}
            },
        };
        
        // --- STATUS & CAMERA FUNCTIONS ---

        /**
         * Updates the status message in the remedy center.
         * @param {string} message - The message to display.
         * @param {string} classes - Tailwind CSS classes for styling.
         */
        function updateStatus(message, classes) {
            webcamStatusEl.innerHTML = message;
            webcamStatusEl.className = `text-sm p-2 rounded-lg transition duration-300 text-center mb-4 ${classes}`;
        }

        /**
         * Stops the camera stream and resets the buttons.
         */
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
                video.srcObject = null;
            }
            video.style.display = 'none';
            startButton.disabled = false;
            captureButton.disabled = true;
        }

        /**
         * Attempts to start the camera stream.
         */
        function startCamera() {
            if (!currentIssueKey) {
                // Prompt user to select an issue first for simulation context
                updateStatus(translations[currentLang].status_error_no_issue_selected, 'text-red-700 bg-red-100');
                return;
            }

            // Hide previous results/images
            remedyResultsEl.classList.add('hidden');
            document.getElementById('captured-image').style.display = 'none';
            document.getElementById('capture-heading').style.display = 'none';
            document.getElementById('sample-error-message').classList.add('hidden');
            document.querySelectorAll('.sample-image-button').forEach(btn => btn.classList.remove('active'));

            updateStatus(translations[currentLang].status_start_attempt, 'text-brand-primary-dark bg-brand-card-bg');
            startButton.disabled = true;
            captureButton.disabled = true;
            video.style.display = 'block';
            
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
                .then(s => {
                    stream = s;
                    video.srcObject = stream;
                    video.play();
                    captureButton.disabled = false;
                    const issueName = translations[currentLang][currentIssueKey];
                    updateStatus(translations[currentLang].status_camera_active(issueName), 'text-brand-primary-dark bg-brand-card-bg');
                })
                .catch(err => {
                    video.style.display = 'none';
                    startButton.disabled = false;
                    if (err.name === 'NotAllowedError' || err.name === 'PermissionDeniedError') {
                        updateStatus(translations[currentLang].status_error_denied, 'text-red-700 bg-red-100');
                    } else if (err.name === 'NotFoundError') {
                        updateStatus(translations[currentLang].status_error_not_found, 'text-red-700 bg-red-100');
                    } else if (err.name === 'NotReadableError') {
                        updateStatus(translations[currentLang].status_error_not_readable, 'text-red-700 bg-red-100');
                    } else {
                        console.error("Error accessing camera: ", err);
                        updateStatus(translations[currentLang].status_error_general, 'text-red-700 bg-red-100');
                    }
                });
        }

        /**
         * Captures a frame from the video feed and simulates the analysis.
         */
        function captureFrame() {
            if (!currentIssueKey) {
                 updateStatus(translations[currentLang].status_error_no_issue_selected, 'text-red-700 bg-red-100');
                return;
            }
            if (!stream || !video.srcObject) {
                 updateStatus(translations[currentLang].status_error_stream_inactive, 'text-red-700 bg-red-100');
                return;
            }

            // Draw the frame onto the canvas
            captureCanvas.width = video.videoWidth;
            captureCanvas.height = video.videoHeight;
            const ctx = captureCanvas.getContext('2d');
            ctx.scale(-1, 1);
            ctx.drawImage(video, 0, 0, -captureCanvas.width, captureCanvas.height);
            
            // Stop the camera
            stopCamera();

            // Display the captured image
            capturedImage.src = captureCanvas.toDataURL('image/png');
            capturedImage.style.display = 'block';
            document.getElementById('capture-heading').style.display = 'block';

            // Simulate analysis: The model confirms the issue selected in Step 1 (currentIssueKey)
            const issueName = translations[currentLang][currentIssueKey];
            updateStatus(translations[currentLang].status_capture_simulated(issueName), 'text-white bg-brand-primary-accent');
            
            // Display the remedy based on the prediction
            viewExpertRemedy(currentIssueKey);
        }

        // --- NEW SAMPLE IMAGE FUNCTIONS ---

        /**
         * Renders the sample image buttons.
         * @param {string} lang - The current language.
         */
        function renderSampleImages(lang) {
            const container = document.getElementById('sample-image-grid');
            const t = translations[lang];

            let html = Object.keys(sampleImages).map(issueKey => {
                const issueLabel = t[issueKey] || issueKey.split('_').pop().toUpperCase();
                let placeholderText;
                switch(issueKey) {
                    case 'issue_acne': placeholderText = 'ACNE'; break;
                    case 'issue_redness': placeholderText = 'REDNESS'; break;
                    case 'issue_dryness': placeholderText = 'DRYNESS'; break;
                    case 'issue_darkspots': placeholderText = 'SPOTS'; break;
                    case 'issue_sunburn': placeholderText = 'SUNBURN'; break;
                    default: placeholderText = issueLabel.split(' ')[0].toUpperCase();
                }

                return `
                    <button class="sample-image-button relative rounded-lg overflow-hidden transition duration-200 hover:shadow-lg active:scale-95" 
                            data-issue-key="${issueKey}">
                        <img src="${sampleImages[issueKey].src}" alt="${issueLabel}" 
                            class="w-full h-auto object-cover border-2 border-transparent"
                            title="${issueLabel}">
                        <span class="absolute inset-0 bg-brand-primary-dark/30 flex items-center justify-center text-white text-xs font-semibold opacity-0 hover:opacity-100 transition duration-200">${placeholderText}</span>
                    </button>
                `;
            }).join('');

            container.innerHTML = html;

            // Attach event listeners
            document.querySelectorAll('.sample-image-button').forEach(button => {
                button.addEventListener('click', () => {
                    useSampleImage(button);
                });
            });
        }

        /**
         * Simulates analysis using a selected sample image.
         * @param {HTMLElement} button - The button element clicked.
         */
        function useSampleImage(button) {
            if (!currentIssueKey) {
                // Prompt user to select an issue first for simulation context
                document.getElementById('sample-error-message').textContent = translations[currentLang].status_error_no_issue_selected;
                document.getElementById('sample-error-message').classList.remove('hidden');
                updateStatus(translations[currentLang].status_error_no_issue_selected, 'text-red-700 bg-red-100');
                return;
            }
            
            // Hide previous results
            remedyResultsEl.classList.add('hidden');
            document.getElementById('sample-error-message').classList.add('hidden');

            // 1. Visually select the button and deselect others
            document.querySelectorAll('.sample-image-button').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            // 2. Stop camera if running
            stopCamera(); // This function will hide the video feed

            // 3. Display the sample image as the captured frame
            const issueKey = button.getAttribute('data-issue-key');
            capturedImage.src = sampleImages[issueKey].src;
            capturedImage.style.display = 'block';
            document.getElementById('capture-heading').style.display = 'block';

            // 4. Update Status (Model Prediction Simulation)
            const t = translations[currentLang];
            const issueName = t[currentIssueKey]; // Use the pre-selected issue for simulation context
            updateStatus(t.status_capture_simulated(issueName), 'text-white bg-brand-primary-accent');
            
            // 5. Display the remedy results based on the pre-selected issue
            viewExpertRemedy(currentIssueKey);
        }

        // --- RENDERING FUNCTIONS ---

        /**
         * Renders the issue selection buttons.
         * @param {string} lang - The current language key.
         */
        function renderIssueSelection(lang) {
            const container = document.getElementById('issue-selector');
            const t = translations[lang];

            let html = issues.map(issueKey => `
                <button class="issue-button text-brand-primary-dark bg-brand-primary-accent/10 hover:bg-brand-primary-dark hover:text-white font-medium py-2 px-4 rounded-full text-sm transition duration-200"
                        data-issue-key="${issueKey}"
                        data-translate="${issueKey}">
                    ${t[issueKey]}
                </button>
            `).join('');

            container.innerHTML = html;

            document.querySelectorAll('.issue-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const issueKey = e.currentTarget.getAttribute('data-issue-key');
                    handleIssueSelection(issueKey, e.currentTarget);
                });
            });
        }

        /**
         * Handles selection of an issue, either for direct remedy or for simulation context.
         * @param {string} issueKey - The key of the selected issue.
         * @param {HTMLElement} button - The button element clicked.
         */
        function handleIssueSelection(issueKey, button) {
            currentIssueKey = issueKey;
            
            // Highlight selected button across all methods
            document.querySelectorAll('.issue-button').forEach(btn => {
                btn.classList.replace('bg-brand-primary-dark', 'bg-brand-primary-accent/10');
                btn.classList.remove('text-white');
            });
            // Note: button might be null if called from another context (like switchTab), so check before using
            if (button) {
                button.classList.replace('bg-brand-primary-accent/10', 'bg-brand-primary-dark');
                button.classList.add('text-white');
            }
            
            // Reset visual state for Camera/Sample Image
            stopCamera();
            document.getElementById('captured-image').style.display = 'none';
            document.getElementById('capture-heading').style.display = 'none';
            document.getElementById('sample-error-message').classList.add('hidden');
            document.querySelectorAll('.sample-image-button').forEach(btn => btn.classList.remove('active'));

            // Check the active tab and determine next action
            const activeTab = document.querySelector('.tab-button.active-tab').getAttribute('data-tab');
            const t = translations[currentLang];
            const issueName = t[issueKey];

            if (activeTab === 'issue') {
                // If in 'Issue Name' tab, immediately show remedy
                updateStatus(t.status_issue_selected_direct(issueName), 'text-white bg-brand-primary-dark');
                viewExpertRemedy(issueKey);
            } else {
                // If in 'Live Camera' or 'Sample Image' tab, set the context and wait for simulation trigger
                remedyResultsEl.classList.add('hidden');
                updateStatus(`Issue set to: **${issueName}**. Now, click the **Start Camera** button or select a **Sample Image** to run the analysis simulation.`, 'text-brand-primary-dark bg-brand-card-bg');
            }
        }
        
        // --- TAB SWITCHING FUNCTION ---
        function switchTab(tabName) {
            // Deactivate all buttons and content
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active-tab');
                btn.classList.remove('text-brand-primary-dark');
                btn.classList.remove('border-brand-primary-dark/80');
                btn.classList.add('text-brand-subtle-text');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            // Activate the selected tab
            const activeBtn = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
            const activeContent = document.getElementById(`tab-content-${tabName}`);

            if (activeBtn) {
                activeBtn.classList.add('active-tab');
                activeBtn.classList.remove('text-brand-subtle-text');
                activeBtn.classList.add('text-brand-primary-dark');
                activeBtn.classList.add('border-brand-primary-dark/80');
            }
            if (activeContent) {
                activeContent.classList.remove('hidden');
            }
            
            // Special handling for Camera/Sample tabs to stop the camera when switching away
            if (tabName !== 'camera') {
                stopCamera();
            }

            // Reset status message
            if (!currentIssueKey) {
                updateStatus(translations[currentLang].status_initial, 'text-brand-primary-dark bg-brand-card-bg');
                remedyResultsEl.classList.add('hidden');
            } else {
                // If an issue is selected, update status based on the new tab context
                const issueName = translations[currentLang][currentIssueKey];
                if (tabName === 'issue') {
                    // Re-show results immediately if switching back to 'issue' tab
                    updateStatus(translations[currentLang].status_issue_selected_direct(issueName), 'text-white bg-brand-primary-dark');
                    viewExpertRemedy(currentIssueKey);
                } else {
                    // Set context for simulation tabs
                    remedyResultsEl.classList.add('hidden');
                    updateStatus(`Issue set to: **${issueName}**. Now, click the **Start Camera** button or select a **Sample Image** to run the analysis simulation.`, 'text-brand-primary-dark bg-brand-card-bg');
                }
            }
        }

        /**
         * Renders the ingredient filter checkboxes.
         */
        function renderIngredientFilters(lang) {
            const container = document.getElementById('ingredient-filters');
            const t = translations[lang];

            const filters = [
                { key: 'anti_inflammatory', label: t.prop_anti_inflammatory },
                { key: 'antioxidant', label: t.prop_antioxidant },
                { key: 'moisturizing', label: t.prop_moisturizing },
                { key: 'antibacterial', label: t.prop_antibacterial }
            ];

            let html = filters.map(f => `
                <label>
                    <input type="checkbox" class="filter-input property-filter" value="${f.key}">
                    <span class="filter-label">${f.label}</span>
                </label>
            `).join('');

            container.innerHTML = html;

            document.querySelectorAll('.property-filter').forEach(checkbox => {
                checkbox.addEventListener('change', filterAndRenderIngredients);
            });

            filterAndRenderIngredients();
        }

        /**
         * Filters the ingredients based on checked properties and calls the render function.
         */
        function filterAndRenderIngredients() {
            const activeFilters = Array.from(document.querySelectorAll('.property-filter'))
                .filter(checkbox => checkbox.checked)
                .map(checkbox => checkbox.value);

            let filteredIngredients;
            
            if (activeFilters.length === 0) {
                filteredIngredients = ingredientsData;
            } else {
                filteredIngredients = ingredientsData.filter(ingredient => {
                    return activeFilters.every(filterKey => ingredient.properties.includes(filterKey));
                });
            }
            
            renderIngredientGrid(filteredIngredients, currentLang);
        }

        /**
         * Renders the ingredient list into the grid container.
         */
        function renderIngredientGrid(ingredients, lang) {
            const gridContainer = document.getElementById('ingredient-grid');
            const t = translations[lang];
            
            const html = ingredients.map(ingredient => {
                const propertiesHtml = ingredient.properties.map(propKey => {
                    const propName = t['prop_' + propKey] || propKey;
                    return `<span class="inline-block bg-brand-primary-accent/20 text-brand-primary-dark text-xs font-semibold px-2 py-0.5 rounded-full mr-1">${propName}</span>`;
                }).join('');

                const name = t[ingredient.key] || ingredient.key;
                
                return `
                    <div class="ingredient-card bg-brand-bg p-4 rounded-xl shadow-lg hover:shadow-xl transition duration-300">
                        <h4 class="text-lg font-bold text-brand-primary-dark">${name}</h4>
                        <div class="mt-2">
                            ${propertiesHtml}
                        </div>
                    </div>
                `;
            }).join('');

            if (ingredients.length === 0) {
                 gridContainer.innerHTML = `<p class="lg:col-span-3 text-center text-brand-subtle-text p-4">No ingredients match all selected properties. Try removing a filter.</p>`;
                 return;
            }

            gridContainer.innerHTML = html;
        }

        /**
         * Renders the detailed remedy cards based on the predicted skin issue.
         * @param {string} issueKey - The issue key predicted by the simulated model.
         */
        function viewExpertRemedy(issueKey) {
            const issueData = commonRemedies[issueKey];
            const t = translations[currentLang];

            if (!issueData) {
                document.getElementById('error-message').textContent = t.remedy_not_found(issueKey);
                document.getElementById('error-message').classList.remove('hidden');
                remedyResultsEl.classList.add('hidden');
                return;
            }

            document.getElementById('error-message').classList.add('hidden');
            remedyResultsEl.classList.remove('hidden');
            document.getElementById('result-issue-title').textContent = t[issueKey];
            document.getElementById('result-issue-description').textContent = t[issueData.issueDescKey];

            function renderRemedyCard(remedyData, containerId) {
                const container = document.getElementById(containerId);
                const propertiesHtml = Object.entries(remedyData.property_match).map(([propKey, level]) => {
                    const propName = t['prop_' + propKey] || propKey;
                    const levelClass = level === 'high' ? 'bg-red-400' : level === 'medium' ? 'bg-yellow-400' : 'bg-gray-300';
                    return `<span class="text-xs font-semibold py-1 px-3 rounded-full bg-brand-primary-accent/20 text-brand-primary-dark mr-2 mb-1">${propName}</span>`;
                }).join('');

                const ingredientsList = remedyData.keyIngredients.map(ingKey => 
                    `<li class="text-sm text-brand-text py-1 border-b border-brand-subtle-text/10">${t[ingKey] || ingKey}</li>`
                ).join('');

                const instructionsList = remedyData.instructionsKeys.map(instKey => 
                    `<li class="text-sm text-brand-subtle-text mb-2">${t[instKey] || instKey}</li>`
                ).join('');

                container.innerHTML = `
                    <h4 class="text-xl font-bold text-brand-text mb-2">${t[remedyData.remedyNameKey]}</h4>
                    <p class="text-sm text-brand-subtle-text mb-4">${t[remedyData.descriptionKey]}</p>
                    
                    <div class="flex flex-wrap gap-y-1 mb-4">${propertiesHtml}</div>

                    <div class="mb-4">
                        <h5 class="text-md font-semibold text-brand-primary-dark mb-1">${t.remedy_key_ingredients}</h5>
                        <ul class="list-none pl-0 border-t border-brand-subtle-text/10">${ingredientsList}</ul>
                    </div>

                    <div>
                        <h5 class="text-md font-semibold text-brand-primary-dark mb-2">${t.remedy_instructions}</h5>
                        <ol class="list-decimal list-inside pl-0 space-y-2">${instructionsList}</ol>
                    </div>
                `;
            }

            renderRemedyCard(issueData.remedy1, 'remedy-1-container');
            renderRemedyCard(issueData.remedy2, 'remedy-2-container');
        }

        /**
         * Updates all data-translate elements with the selected language.
         */
        function updateLanguage(lang) {
            currentLang = lang;
            const t = translations[lang];

            // 1. Update static elements
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (typeof t[key] === 'string') {
                    el.textContent = t[key];
                }
            });

            // 2. Re-render dynamic elements
            renderIssueSelection(currentLang);
            renderIngredientFilters(currentLang);
            renderSampleImages(currentLang); 
            renderChart(currentLang); // Re-render chart labels
            
            // 3. Update remedy results if they are currently displayed
            if (currentIssueKey && !remedyResultsEl.classList.contains('hidden')) {
                viewExpertRemedy(currentIssueKey);
            }
            
            // 4. Update tab status based on current tab
            const activeTab = document.querySelector('.tab-button.active-tab').getAttribute('data-tab');
            if (activeTab === 'issue' && currentIssueKey) {
                const issueName = t[currentIssueKey];
                updateStatus(t.status_issue_selected_direct(issueName), 'text-white bg-brand-primary-dark');
            } else if (currentIssueKey) {
                const issueName = t[currentIssueKey];
                updateStatus(`Issue set to: **${issueName}**. Now, click the **Start Camera** button or select a **Sample Image** to run the analysis simulation.`, 'text-brand-primary-dark bg-brand-card-bg');
            } else {
                updateStatus(t.status_initial, 'text-brand-primary-dark bg-brand-card-bg');
            }
        }

        /**
         * Renders the donut chart using Chart.js.
         */
        function renderChart(lang) {
            const ctx = document.getElementById('skinConcernsChart');
            const t = translations[lang];
            
            if (window.skinConcernsChartInstance) {
                window.skinConcernsChartInstance.destroy();
            }

            window.skinConcernsChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: chartData.labels.map(label => {
                        // Map English label to translated issue key
                        const keyMap = {
                            'Acne & Blemishes': 'issue_acne',
                            'Dryness & Dehydration': 'issue_dryness',
                            'Redness & Irritation': 'issue_redness',
                            'Oily Skin & Pores': 'issue_oily',
                            'Other': 'Other'
                        };
                        const issueKey = keyMap[label];
                        return t[issueKey] || label;
                    }),
                    datasets: [{
                        data: chartData.data,
                        backgroundColor: [
                            '#38761D', // brand-primary-dark
                            '#6AA84F', // brand-primary-accent
                            '#C28B38', // Muted brown/orange
                            '#60735E', // brand-subtle-text
                            '#A4C639'  // Lighter green
                        ],
                        hoverOffset: 4,
                        borderWidth: 2,
                        borderColor: '#FFFCF5' // brand-bg
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#2C3A2F', // brand-text
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) { label += ': '; }
                                    if (context.parsed !== null) { label += context.parsed + '%'; }
                                    return label;
                                }
                            }
                        }
                    },
                    cutout: '70%',
                }
            });
        }

        // --- Initialization and Event Handlers (FIXED BLOCK) ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. Core Initialization
            updateLanguage(currentLang);
            
            // 2. Initial Tab View
            switchTab('issue');
            
            // 3. Attach Tab Switching Listeners
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const tabName = e.currentTarget.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });

            // 4. Language Selector Change Listener
            document.getElementById('language-selector').addEventListener('change', (e) => {
                updateLanguage(e.target.value);
            });
            
            // 5. Attach Webcam Event Listeners
            startButton.addEventListener('click', startCamera);
            captureButton.addEventListener('click', captureFrame);
            
            // 6. Initialize status message
            updateStatus(translations[currentLang].status_initial, 'text-brand-primary-dark bg-brand-card-bg');
        });
    </script>
</body>
</html>
